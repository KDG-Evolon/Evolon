<!DOCTYPE html>
<html lang="ja"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <title>販売履歴 - フリマアプリ</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>
<div class="container">

    <h1>販売履歴</h1>
    <p>あなたが販売した商品の一覧です。</p>

    <table>
        <thead>
        <tr>
            <th>商品名</th>
            <th>購入者</th>
            <th>価格</th>
            <th>ステータス</th>
            <th>操作</th>
        </tr>
        </thead>

        <tbody>
        <!-- 販売履歴がある場合 -->
        <tr th:each="order : ${mySales}">
            <td th:text="${order.item.name}"></td>
            <td th:text="${order.buyer.name}"></td>
            <td th:text="'¥' + ${#numbers.formatDecimal(order.price, 0, 'COMMA', 0, 'POINT')}"></td>

            <!-- enumのラベル表示 -->
            <td th:text="${order.orderStatus.label}"></td>

            <!-- 発送操作：PURCHASED（=発送待ち）のときだけ -->
            <td>
				<form th:if="${order.orderStatus.name() == 'PURCHASED'}"
				      th:action="@{/orders/{id}/ship(id=${order.id})}"
				      method="post">
				  <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
				  <button type="submit" class="button">発送済みにする</button>
				</form>
                <!-- すでに発送済み・到着確認済みのときの表示 -->
                <span th:if="${order.orderStatus.name() != 'PURCHASED'}">-</span>
            </td>
        </tr>

        <!-- 販売履歴が空の場合 -->
        <tr th:if="${#lists.isEmpty(mySales)}">
            <td colspan="5">販売した商品はありません。</td>
        </tr>
        </tbody>
    </table>

    <div class="button-group">
        <a th:href="@{/my-page}" class="button secondary">マイページに戻る</a>
    </div>

</div>
</body>
</html>
